<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>meister</title>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>     
        <script src="https://www.gstatic.com/firebasejs/4.11.0/firebase-firestore.js"></script>
        <!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
    </head>
    <body>
        <h1>システムプログラミング</h1>
        
        <div>
            <ul id="messages"></ul>
            <input id="name" placeholder="名前">
            <input id="message" placeholder="メッセージ">
            <button id="send" >投稿</button>
            
        </div>
        <script>
	    var firebaseConfig = {
            apiKey: "AIzaSyBzqt4mbO4Cm2IgKb3oBsKfzZ_EtG-nF3s",
 	    authDomain: "nyao-a5a41.firebaseapp.com",
    	    databaseURL: "https://nyao-a5a41.firebaseio.com",
 	    projectId: "nyao-a5a41",
	    storageBucket: "nyao-a5a41.appspot.com",
 	    messagingSenderId: "151426946338",
 	    appId: "1:151426946338:web:b7540084e89f2a30a0017b"
 	    };
  	    // Initialize Firebase
  	    firebase.initializeApp(firebaseConfig);  
            
            
            // データベースの参照を準備
            var messagesRef = firebase.firestore().collection('messages')
        
            // TODO4 メッセージを表示
            messagesRef.onSnapshot(function(snapshot) {
	        snapshot.docChanges.forEach(function(change) {
	            if (change.type === 'added') {
	                $('<div id="box" class="line__left">').appendTo('#messages');
	   	        $('<div>').text(change.doc.data().name).appendTo('#box');
	   	        $('<div class="text">').text(change.doc.data().body).appendTo('#box');
	    	    }
	        });
	    });
	    	    
            // TODO2 送信ボタンが押された時の処理
            $('#send').click(function() {
	    	$('<p>追加しました</p>').appendTo('#messages');
	    	messagesRef.add({
	    	    name: $('#name').val(),
                    body: $('#message').val()
	    	});
	    });
	    
        </script>
    </body>
</html>
